<!DOCTYPE html>












  


<html class="theme-next gemini use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=6.5.0" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.5.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.5.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.5.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.5.0" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '6.5.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="引言Context对于Android开发人员来说并不陌生，项目中我们会经常使用Context来获取APP资源，创建UI，获取系统Service服务，启动Activity，绑定Service，发送广播，获取APP信息等等。那么Context到底是什么？Context又是怎么来实现以上功能的？在什么场景下使用不同的Context？一个APP中总共有多少个Context？这篇博客将从源码角度带你分析An">
<meta name="keywords" content="Context">
<meta property="og:type" content="article">
<meta property="og:title" content="Android Context是什么？">
<meta property="og:url" content="https://weiteluwei.com/2018/12/11/Android-Context是什么？/index.html">
<meta property="og:site_name" content="KEEM--BLOG">
<meta property="og:description" content="引言Context对于Android开发人员来说并不陌生，项目中我们会经常使用Context来获取APP资源，创建UI，获取系统Service服务，启动Activity，绑定Service，发送广播，获取APP信息等等。那么Context到底是什么？Context又是怎么来实现以上功能的？在什么场景下使用不同的Context？一个APP中总共有多少个Context？这篇博客将从源码角度带你分析An">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://weiteluwei.com/2018/12/11/Android-Context是什么？/con1.png">
<meta property="og:image" content="https://weiteluwei.com/2018/12/11/Android-Context是什么？/con3.png">
<meta property="og:updated_time" content="2018-12-11T13:41:02.088Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Android Context是什么？">
<meta name="twitter:description" content="引言Context对于Android开发人员来说并不陌生，项目中我们会经常使用Context来获取APP资源，创建UI，获取系统Service服务，启动Activity，绑定Service，发送广播，获取APP信息等等。那么Context到底是什么？Context又是怎么来实现以上功能的？在什么场景下使用不同的Context？一个APP中总共有多少个Context？这篇博客将从源码角度带你分析An">
<meta name="twitter:image" content="https://weiteluwei.com/2018/12/11/Android-Context是什么？/con1.png">






  <link rel="canonical" href="https://weiteluwei.com/2018/12/11/Android-Context是什么？/">



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Android Context是什么？ | KEEM--BLOG</title>
  











  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">KEEM--BLOG</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
    
      
    

    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>关于</a>

  </li>

      
      
    </ul>
  

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://weiteluwei.com/2018/12/11/Android-Context是什么？/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Keem Wang">
      <meta itemprop="description" content="Stay hungry Stay foolish">
      <meta itemprop="image" content="/images/avatarx.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="KEEM--BLOG">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Android Context是什么？
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-12-11 16:18:18 / 修改时间：21:41:02" itemprop="dateCreated datePublished" datetime="2018-12-11T16:18:18+08:00">2018-12-11</time>
            

            
              

              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/ANDROID/" itemprop="url" rel="index"><span itemprop="name">ANDROID</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h4 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h4><p>Context对于Android开发人员来说并不陌生，项目中我们会经常使用Context来获取APP资源，创建UI，获取系统Service服务，启动Activity，绑定Service，发送广播，获取APP信息等等。那么Context到底是什么？Context又是怎么来实现以上功能的？在什么场景下使用不同的Context？一个APP中总共有多少个Context？这篇博客将从源码角度带你分析Android Context到底是个啥。</p>
<h4 id="1-Context是什么"><a href="#1-Context是什么" class="headerlink" title="1.Context是什么"></a>1.Context是什么</h4><p>相信很多人多会问Context到底是什么？</p>
<blockquote>
<p>我们可以理解为“上下文”：它贯穿整个应用；</p>
</blockquote>
<blockquote>
<p>也可以理解成“运行环境”：它提供了一个应用运行所需要的信息，资源，系统服务等；</p>
</blockquote>
<blockquote>
<p>同样可以理解成“场景”：用户操作和系统交互这一过程就是一个场景，比如Activity之间的切换，服务的启动等都少不了Context。</p>
</blockquote>
<p>然而以上这些都是我们从抽象角度去理解Context的作用，那么从Code代码来看Context到底是什么呢？Activity是一个Context，Application是一个Context，Service也是一个Context你信么？不信的话，同样还是那句话“Read the fucking source code”。</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">public</span> <span class="selector-tag">abstract</span> <span class="selector-tag">class</span> <span class="selector-tag">Context</span> &#123;</span><br><span class="line">..............................</span><br><span class="line"> <span class="comment">/** Return an AssetManager instance for your application's package. */</span></span><br><span class="line">    <span class="selector-tag">public</span> <span class="selector-tag">abstract</span> <span class="selector-tag">AssetManager</span> <span class="selector-tag">getAssets</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** Return a Resources instance for your application's package. */</span></span><br><span class="line">    <span class="selector-tag">public</span> <span class="selector-tag">abstract</span> <span class="selector-tag">Resources</span> <span class="selector-tag">getResources</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** Return PackageManager instance to find global package information. */</span></span><br><span class="line">    <span class="selector-tag">public</span> <span class="selector-tag">abstract</span> <span class="selector-tag">PackageManager</span> <span class="selector-tag">getPackageManager</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** Return a ContentResolver instance for your application's package. */</span></span><br><span class="line">    <span class="selector-tag">public</span> <span class="selector-tag">abstract</span> <span class="selector-tag">ContentResolver</span> <span class="selector-tag">getContentResolver</span>();</span><br><span class="line"></span><br><span class="line">...................</span><br><span class="line"><span class="comment">//获取系统服务</span></span><br><span class="line"><span class="selector-tag">public</span> <span class="selector-tag">abstract</span> <span class="selector-tag">Object</span> <span class="selector-tag">getSystemService</span>(<span class="variable">@ServiceName</span> <span class="variable">@NonNull</span> String name);</span><br><span class="line"><span class="comment">//发送广播</span></span><br><span class="line"><span class="selector-tag">public</span> <span class="selector-tag">abstract</span> <span class="selector-tag">void</span> <span class="selector-tag">sendBroadcast</span>(Intent intent);</span><br><span class="line"><span class="comment">//启动Activity</span></span><br><span class="line"><span class="selector-tag">public</span> <span class="selector-tag">abstract</span> <span class="selector-tag">void</span> <span class="selector-tag">startActivity</span>(Intent intent);</span><br><span class="line"><span class="comment">//启动服务，绑定服务</span></span><br><span class="line"><span class="selector-tag">public</span> <span class="selector-tag">abstract</span> <span class="selector-tag">ComponentName</span> <span class="selector-tag">startService</span>(Intent service);</span><br><span class="line"><span class="selector-tag">public</span> <span class="selector-tag">abstract</span> <span class="selector-tag">boolean</span> <span class="selector-tag">bindService</span>(Intent service, <span class="variable">@NonNull</span> ServiceConnection conn,</span><br><span class="line">            <span class="variable">@BindServiceFlags</span> int flags);</span><br><span class="line"></span><br><span class="line">................</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>从源码看Context就是一个抽象类，里面定义了各种抽象方法，包括获取系统资源，获取系统服务，发送广播，启动Activity,Service等。所以从源码角度看Context就是抽象出一个App应用所有功能的集合，由于Context是一个纯的抽象类，所以它的具体的方法实现是在其之类ContextImpl中实现了，稍后分析。我们平时在MainActivity中会这么给mContext = this赋值，其言外之意就是当前Activity类就是Context，那说明Activity是Context的子类。通过Android Studio查看Context的子类图如下：</p>
<img src="/2018/12/11/Android-Context是什么？/con1.png">
<p>有图可知，Context的子类很多，我们主要分析以上红色矩形框内的即可。接下来就分析Android系统中Context的继承关系！</p>
<h4 id="2-Android系统中Context的继承关系"><a href="#2-Android系统中Context的继承关系" class="headerlink" title="2.Android系统中Context的继承关系"></a>2.Android系统中Context的继承关系</h4><p>有上一节我们知道，Activity是一个Context，Service也是一个Context等等，那么这些类跟Context具体什么关系呢？接下来有一幅图Context继承关系图来说明： </p>
<img src="/2018/12/11/Android-Context是什么？/con3.png">
<p>Context类是一个抽象类，具体实现在ContextImpl类中；而ContextWrapper是Context的一个包装类，其里面所有的方法实现都是调用其内部mBase变量的方法，而mBase就是ContextImpl对象，稍后分析。然而ContextWrapper还有一个ContextThemeWrapper子类，该类中扩展了主题相关的方法。有继承关系图可以看出，Application和Service是继承自ContextWrapper，而Activity是继承自ContextThemeWrapper，是不是有点奇怪？其实一点都不奇怪，Activity在启动的时候系统都会加载一个主题，也就是我们平时在AndroidManifest.xml文件里面写的android:theme=”@style/AppTheme”属性啦！然而Service和Applicaton都和UI界面并没有卵关系！因此他们继承自ContextWrapper。所以Activity，Application，Service其实都关联着一个mBase变量，而mBase变量是ContextImpl对象的赋值，也是真正实现抽象类Context的地方。虽然Activity，Application，Service都有一个共同的祖先Context，但是他们自己本身持有的Context对象是不同的，接下来我们从源码角度分析以上几个类的实现。</p>
<h4 id="3-不同Context源码分析"><a href="#3-不同Context源码分析" class="headerlink" title="3.不同Context源码分析"></a>3.不同Context源码分析</h4><h4 id="3-1ContextImpl—真正实现Context功能的类"><a href="#3-1ContextImpl—真正实现Context功能的类" class="headerlink" title="3.1ContextImpl—真正实现Context功能的类"></a>3.1ContextImpl—真正实现Context功能的类</h4><p>从源码看出Context类仅仅是定义了一组抽象方法的抽象类，其内部的方法真正实现的地方都在ContextImpl类中。</p>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">class ContextImpl extends Context &#123;</span><br><span class="line">    <span class="comment">//整个App的主线程</span></span><br><span class="line">    final ActivityThread mMainThread;</span><br><span class="line">    <span class="comment">//整个App的相关信息</span></span><br><span class="line">    final LoadedApk mPackageInfo;</span><br><span class="line">    <span class="comment">//资源解析器</span></span><br><span class="line">    <span class="keyword">private</span> final ResourcesManager mResourcesManager;</span><br><span class="line">    <span class="comment">//App资源类</span></span><br><span class="line">    <span class="keyword">private</span> final Resources mResources;</span><br><span class="line">    <span class="comment">//外部Context的引用</span></span><br><span class="line">    <span class="keyword">private</span> Context mOuterContext;</span><br><span class="line">    <span class="comment">//默认主题</span></span><br><span class="line">    <span class="keyword">private</span> int mThemeResource = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> Resources.Theme mTheme = <span class="built_in">null</span>;</span><br><span class="line">    <span class="comment">//包管理器</span></span><br><span class="line">    <span class="keyword">private</span> PackageManager mPackageManager;</span><br><span class="line"></span><br><span class="line">    <span class="params">...</span><span class="params">...</span><span class="params">...</span><span class="params">...</span><span class="params">...</span><span class="params">...</span><span class="params">...</span><span class="params">...</span><span class="params">...</span><span class="params">...</span>..</span><br><span class="line"><span class="comment">//以下是静态区注册系统的各种服务，多大五六十种系统服务，因此每个持有Context引用的对象都可以随时通过getSystemService方法来轻松获取系统服务。</span></span><br><span class="line">static &#123;</span><br><span class="line">        registerService(ACCESSIBILITY_SERVICE, <span class="literal">new</span> ServiceFetcher() &#123;</span><br><span class="line">                <span class="keyword">public</span> Object getService(ContextImpl ctx) &#123;</span><br><span class="line">                    <span class="keyword">return</span> AccessibilityManager.getInstance(ctx);</span><br><span class="line">                &#125;&#125;);</span><br><span class="line"></span><br><span class="line">        registerService(CAPTIONING_SERVICE, <span class="literal">new</span> ServiceFetcher() &#123;</span><br><span class="line">                <span class="keyword">public</span> Object getService(ContextImpl ctx) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">new</span> CaptioningManager(ctx);</span><br><span class="line">                &#125;&#125;);</span><br><span class="line"></span><br><span class="line">        registerService(ACCOUNT_SERVICE, <span class="literal">new</span> ServiceFetcher() &#123;</span><br><span class="line">                <span class="keyword">public</span> Object createService(ContextImpl ctx) &#123;</span><br><span class="line">                    IBinder b = ServiceManager.getService(ACCOUNT_SERVICE);</span><br><span class="line">                    IAccountManager service = IAccountManager.Stub.asInterface(b);</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">new</span> AccountManager(ctx, service);</span><br><span class="line">                &#125;&#125;);</span><br><span class="line">        <span class="params">...</span><span class="params">...</span><span class="params">...</span><span class="params">...</span><span class="params">...</span><span class="params">...</span><span class="params">...</span><span class="params">...</span></span><br><span class="line"></span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line"><span class="params">...</span><span class="params">...</span><span class="params">...</span><span class="params">...</span><span class="params">...</span>..</span><br><span class="line"><span class="comment">//启动Activity的地方</span></span><br><span class="line"> @Override</span><br><span class="line">    <span class="keyword">public</span> <span class="literal">void</span> startActivity(Intent intent, Bundle options) &#123;</span><br><span class="line">        warnIfCallingFromSystemProcess();</span><br><span class="line">        <span class="keyword">if</span> ((intent.getFlags()&amp;Intent.FLAG_ACTIVITY_NEW_TASK) == <span class="number">0</span>) &#123;</span><br><span class="line">            throw <span class="literal">new</span> AndroidRuntimeException(</span><br><span class="line">                    <span class="string">"Calling startActivity() from outside of an Activity "</span></span><br><span class="line">                    + <span class="string">" context requires the FLAG_ACTIVITY_NEW_TASK flag."</span></span><br><span class="line">                    + <span class="string">" Is this really what you want?"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        mMainThread.getInstrumentation().execStartActivity(</span><br><span class="line">            getOuterContext(), mMainThread.getApplicationThread(), <span class="built_in">null</span>,</span><br><span class="line">            (Activity)<span class="built_in">null</span>, intent, <span class="number">-1</span>, options);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="params">...</span><span class="params">...</span><span class="params">...</span>.</span><br><span class="line"><span class="comment">//启动服务的地方</span></span><br><span class="line">@Override</span><br><span class="line">    <span class="keyword">public</span> ComponentName startService(Intent service) &#123;</span><br><span class="line">        warnIfCallingFromSystemProcess();</span><br><span class="line">        <span class="keyword">return</span> startServiceCommon(service, mUser);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="params">...</span><span class="params">...</span><span class="params">...</span><span class="params">...</span><span class="params">...</span>     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>分析：ContextImpl实现了抽象类Context里面的所有方法，获取资源，启动Activity，Service等。值得注意的是在ContextImpl创建的时候就会利用静态区来注册系统的各种服务，因此每个持有Context引用的类都可以通过getSystemService来轻松的获取系统服务了。比如我们平时LayoutInflater类来加载一个XML布局时时这么写的</p>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">LayoutInflater inflater</span> = LayoutInflater.from(mContext);</span><br><span class="line"><span class="attribute">View layout</span> = inflater.inflate(R.layout.activity_main,null);</span><br></pre></td></tr></table></figure>
<p>其实源码内部是这样实现的：</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Obtains the LayoutInflater from the given context.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> LayoutInflater <span class="title">from</span>(<span class="params">Context context</span>)</span> &#123;</span><br><span class="line">        LayoutInflater LayoutInflater =</span><br><span class="line">                (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE);</span><br><span class="line">        <span class="keyword">if</span> (LayoutInflater == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> AssertionError(<span class="string">"LayoutInflater not found."</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> LayoutInflater;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>可以看出LayoutInflater布局加载器也是调用context.getSystemService(Context.LAYOUT_INFLATER_SERVICE);来获取系统服务得到的。因此我们以后在代码中也可以这么来加载一个XML布局：</p>
<figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">//获取服务</span></span><br><span class="line">LayoutInflater inflater = (LayoutInflater) mContext.getSystemService(Context.LAYOUT_INFLATER_SERVICE);</span><br><span class="line"><span class="built_in">View</span> layout = inflater.inflate(R.layout.activity_main,<span class="built_in">null</span>);</span><br></pre></td></tr></table></figure>
<p>由于ContextImpl是抽象类Context的具体实现，而Application，Activity，Service的祖先又都是Context类，那么它们都关联着一个ContextImpl对象来真正实现Context里面所有的方法。现在来分析下不同子类创建的Context对象。</p>
<h4 id="3-2ContextWrapper"><a href="#3-2ContextWrapper" class="headerlink" title="3.2ContextWrapper"></a>3.2ContextWrapper</h4><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ContextWrapper</span> <span class="keyword">extends</span> <span class="title">Context</span> </span>&#123;</span><br><span class="line">    Context mBase;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ContextWrapper</span><span class="params">(Context base)</span> </span>&#123;</span><br><span class="line">        mBase = base;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Set the base context for this ContextWrapper.  All calls will then be</span></span><br><span class="line"><span class="comment">     * delegated to the base context.  Throws</span></span><br><span class="line"><span class="comment">     * IllegalStateException if a base context has already been set.</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> base The new base context for this wrapper.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">void</span> <span class="title">attachBaseContext</span><span class="params">(Context base)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (mBase != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"Base context already set"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        mBase = base;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the base context as set by the constructor or setBaseContext</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function">Context <span class="title">getBaseContext</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> mBase;</span><br><span class="line">    &#125;</span><br><span class="line"> ...................</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function">AssetManager <span class="title">getAssets</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">return</span> mBase.<span class="title">getAssets</span><span class="params">()</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Resources getResources()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">return</span> mBase.<span class="title">getResources</span><span class="params">()</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function">PackageManager <span class="title">getPackageManager</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">return</span> mBase.<span class="title">getPackageManager</span><span class="params">()</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">...............</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>分析：从ContextWrapper源码可以看到，这个类只是一个装饰类，其内部所有方法的实现都指向mBase成员变量，而然谁给mBase成员变量赋值呢？结论是Context的真正实现类ContextImpl对象，后面会分析到。该类中通过attachBaseContext方法将ContextImpl对象赋值给mBase成员变量。</p>
<p>每一个App应用都是由ASM通过Binder机制创建一个新的进程然后调用ActivityThread类中的main方法开始的。很多人可能会感到奇怪为啥Android也是基于Java实现的，为啥没有看到main方法呢？其实整个App应用的入口在ActivityThread.main方法里面啦！关于Activity启动过程请参考大神级别人物老罗的这篇博客：Android应用程序的Activity启动过程简要介绍和学习计划。所有有关Application，Activity，Service的创建都是在ActivityThread类中，其实该类就是我们App的主线程。</p>
<h4 id="3-3Application中的Context"><a href="#3-3Application中的Context" class="headerlink" title="3.3Application中的Context"></a>3.3Application中的Context</h4><p>每一个应用在启动的时候都会创建一个Application对象，该对象是全局的，开发者可以实现一个子类MyApplication类来继承Application，然后实现一些全局的方法或者数据。</p>
<p>应用入口ActivityThread#main</p>
<figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">public static void main(String[] args) &#123;</span><br><span class="line">       ................</span><br><span class="line">       <span class="comment">//初始化Looper</span></span><br><span class="line">       Looper.prepareMainLooper();</span><br><span class="line">       <span class="comment">//创建一个APP主线程ActivityThread对象</span></span><br><span class="line">       ActivityThread thread = new ActivityThread();</span><br><span class="line">       <span class="comment">//初始化App应用信息</span></span><br><span class="line">       thread.attach(false);</span><br><span class="line">       <span class="comment">//获得主线程也就是UI线程的handler对象</span></span><br><span class="line">       <span class="keyword">if</span> (sMainThreadHandler == null) &#123;</span><br><span class="line">           sMainThreadHandler = thread.getHandler();</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="comment">//此处值得注意了，在Android4.1版本之后添加了这么一个方法，目的就是为了能让AsyncTask能在子线程创建，</span></span><br><span class="line">       <span class="comment">//在之前的版本是不能在子线程中创建初始化AsyncTask的。</span></span><br><span class="line">       <span class="comment">//对AsyncTask感兴趣的童鞋可以参考这篇博客[ Android异步任务处理框架AsyncTask源码分析](http://blog.csdn.net/feiduclear_up/article/details/46860015)</span></span><br><span class="line">       AsyncTask.init();</span><br><span class="line">       <span class="comment">//启动Looper循环，进入消息循环。</span></span><br><span class="line">       Looper.loop();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>分析：main方法主要工作就是创建一个App应用的主线程ActivityThread并初始化，且构建一个消息循环机制用于处理UI交互。代码第6-8行，创建了一个应用的主线程ActivityThread并且调用attach方法来初始化。进入attach方法： </p>
<p><strong>ActivityThread#attach</strong></p>
<figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">private void attach(boolean <span class="keyword">system</span>) &#123;</span><br><span class="line">    <span class="comment">//整个应用的Application对象</span></span><br><span class="line">    Application mInitialApplication;</span><br><span class="line">    <span class="comment">//整个应用的后台管家</span></span><br><span class="line">    Instrumentation mInstrumentation;</span><br><span class="line">        ................</span><br><span class="line">            try &#123;</span><br><span class="line">                mInstrumentation = new Instrumentation();</span><br><span class="line">                ContextImpl context = ContextImpl.createAppContext(</span><br><span class="line">                        this, getSystemContext().mPackageInfo);</span><br><span class="line">                <span class="comment">//利用ContextImpl创建整个应用的Application对象</span></span><br><span class="line">                mInitialApplication = context.mPackageInfo.makeApplication(true, null);</span><br><span class="line">                <span class="comment">//调用Application对象的onCreate方法</span></span><br><span class="line">                mInitialApplication.onCreate();</span><br><span class="line">            &#125; </span><br><span class="line">       ................</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>代码第13行：通过调用LoadedApk#makeApplication方法创建应用程序的Application对象。 </p>
<p><strong>LoadedApk#makeApplication</strong></p>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Application makeApplication(<span class="built_in">boolean</span> forceDefaultAppClass,</span><br><span class="line">            Instrumentation instrumentation) &#123;</span><br><span class="line">        <span class="comment">//第一次进来mApplication==null条件不满足，之后创建Activity的时候条件满足直接返回当前Application对象</span></span><br><span class="line">        <span class="keyword">if</span> (mApplication != <span class="built_in">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> mApplication;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Application app = <span class="built_in">null</span>;</span><br><span class="line"></span><br><span class="line">        try &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//为Appliaction创建ContextImpl对象</span></span><br><span class="line">            ContextImpl appContext = ContextImpl.createAppContext(mActivityThread, this);</span><br><span class="line">            <span class="comment">//调用Instrumentation类中的newApplication方法创建Application</span></span><br><span class="line">            app = mActivityThread.mInstrumentation.newApplication(</span><br><span class="line">                    cl, appClass, appContext);</span><br><span class="line">            <span class="comment">//给ContextImpl设置外部引用</span></span><br><span class="line">            appContext.setOuterContext(app);</span><br><span class="line">        &#125; </span><br><span class="line">      <span class="params">...</span><span class="params">...</span><span class="params">...</span><span class="params">...</span><span class="params">...</span><span class="params">...</span>..</span><br><span class="line">        <span class="keyword">return</span> app;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>分析：<br>1.代码第4-6行：判断当前应用是否是第一次创建Application对象，如果不是则直接返回Application对象，否则去创建第一个Application对象。目的是确保当前应用之创建了一个全局的Application对象。<br>2.代码第13行：创建了一个ContextImpl对象，然后作为参数用于创建Application对象。<br>3.代码第15行：调用Instrumentation类中的newApplication方法来创建Application对象。<br>4.代码第18行：将创建好的Application对象赋值给ContextImpl类的mOuterContext成员变量，目的是让ContextImpl持有外部Application类的引用用于注册系统服务或者其他方法。</p>
<p><strong>Instrumentation#newApplication</strong></p>
<figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Application <span class="keyword">new</span><span class="type">Application</span>(ClassLoader cl, <span class="keyword">String</span> className, Context context)</span><br><span class="line">            throws InstantiationException, IllegalAccessException, </span><br><span class="line">            ClassNotFoundException &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span><span class="type">Application</span>(cl.loadClass(className), context);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">public</span> Application <span class="keyword">new</span><span class="type">Application</span>(Class&lt;?&gt; clazz, Context context)</span><br><span class="line">            throws InstantiationException, IllegalAccessException, </span><br><span class="line">            ClassNotFoundException &#123;</span><br><span class="line">        Application app = (Application)clazz.<span class="keyword">new</span><span class="type">Instance</span>();</span><br><span class="line">        app.attach(context);</span><br><span class="line">        <span class="keyword">return</span> app;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>分析：以上代码通过类加载器来创建Application对象，并且调用app.attach（context）方法来初始化Application对象。这里的context就是上面传下来的ContextImpl对象了。进入Application源码 </p>
<p><strong>Application#attach</strong></p>
<figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">public <span class="keyword">class</span> Application extends ContextWrapper implements ComponentCallbacks2 &#123;</span><br><span class="line">..................</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @hide</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">/* package */</span> final void attach(Context context) &#123;</span><br><span class="line">        attachBaseContext(context);</span><br><span class="line">        mLoadedApk = ContextImpl.getImpl(context).mPackageInfo;</span><br><span class="line">    &#125;</span><br><span class="line">...............</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>分析：Application类是继承自ContextWrapper类，在attach方法中调父类也就是ContextWrapper中的attachBaseContext方法来对ContextWrapper的成员变量mBase赋值成ContextImpl对象，具体可以参考3.2小节。因此Application通过父类ContextWrapper类的成员变量mBase指向了ContextImpl，让Application类真正实现了其祖父类Context抽象类中的所有抽象方法。</p>
<h4 id="3-4Activity中的Context"><a href="#3-4Activity中的Context" class="headerlink" title="3.4Activity中的Context"></a>3.4Activity中的Context</h4><p>当Application创建完成之后，ASM会通过Binder机制通知ActivityThread去创建需要的Activity了。最后会辗转到ActivityThread类中的performLaunchActivity方法来创建Activity。</p>
<p><strong>ActivityThread#performLaunchActivity</strong></p>
<figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">private Activity performLaunchActivity(ActivityClientRecord r, Intent customIntent) &#123;</span><br><span class="line">        ........................</span><br><span class="line"></span><br><span class="line">        Activity activity = null;</span><br><span class="line">        try &#123;</span><br><span class="line">        <span class="comment">//通过Instrumentation类的newActivity方法来创建一个Activity对象</span></span><br><span class="line">            java.lang.ClassLoader cl = r.packageInfo.getClassLoader();</span><br><span class="line">            activity = mInstrumentation.newActivity(</span><br><span class="line">                    cl, component.getClassName(), r.intent);</span><br><span class="line">           ..........................</span><br><span class="line">        &#125;</span><br><span class="line">        try &#123;</span><br><span class="line">            <span class="comment">//获取当前应用的Application对象，该对象的唯一作用就是作为参数传递到Activity里，</span></span><br><span class="line">            然后在Activity类中可以获得调用getApplication方法来获取Application对象</span><br><span class="line">            Application app = r.packageInfo.makeApplication(false, mInstrumentation);</span><br><span class="line"></span><br><span class="line">          .............................</span><br><span class="line">            <span class="keyword">if</span> (activity != null) &#123;</span><br><span class="line">                <span class="comment">//为Activity创建ContextImpl对象</span></span><br><span class="line">                Context appContext = createBaseContextForActivity(r, activity);</span><br><span class="line">                <span class="comment">//为Activity赋值初始化</span></span><br><span class="line">                 activity.attach(appContext, this, getInstrumentation(), r.token,</span><br><span class="line">                        r.ident, app, r.intent, r.activityInfo, title, r.parent,</span><br><span class="line">                        r.embeddedID, r.lastNonConfigurationInstances, config,</span><br><span class="line">                        r.voiceInteractor);</span><br><span class="line">               ...................</span><br><span class="line">                <span class="comment">//获取当前应用的主题资源</span></span><br><span class="line">                int theme = r.activityInfo.getThemeResource();</span><br><span class="line">                <span class="keyword">if</span> (theme != <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="comment">//设置主题</span></span><br><span class="line">                    activity.setTheme(theme);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                activity.mCalled = false;</span><br><span class="line">                <span class="keyword">if</span> (r.isPersistable()) &#123;</span><br><span class="line">                <span class="comment">//辗转到Activity，调用Activity的生命周期onCreate方法</span></span><br><span class="line">                    mInstrumentation.callActivityOnCreate(activity, r.state, r.persistentState);</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    mInstrumentation.callActivityOnCreate(activity, r.state);</span><br><span class="line">                &#125;</span><br><span class="line">                .............</span><br><span class="line">                r.activity = activity;</span><br><span class="line">                r.stopped = true;</span><br><span class="line">                <span class="keyword">if</span> (!r.activity.mFinished) &#123;</span><br><span class="line">                <span class="comment">//调用Activity的生命周期onStart方法</span></span><br><span class="line">                    activity.performStart();</span><br><span class="line">                    r.stopped = false;</span><br><span class="line">                &#125;</span><br><span class="line">                ......................</span><br><span class="line"></span><br><span class="line">        return activity;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>分析：</p>
<p>step1 这里也是通过Instrumentation类的newActivity方法来创建一个Activity对象，跟上面创建Application对象基本类似，这里就不贴源码了。<br>step2 之后在调用本地方法 createBaseContextForActivity去创建ContextImpl对象，该对象将作为参数传递到Activity#attach方法中。<br>step3 调用Activity#attach方法对刚创建好的Activity进行初始化操作。后面会分析Activity#attach方法。<br>step4 获取当前应用的主题资源，然后调用Activity#setTheme方法给刚创建好的Activity对象设置主题。<br>setp5 一次调用Activity的生命周期方法onCreate，onStart。</p>
<p><strong>step2 </strong><br>现在来分析下ActivityThread#createBaseContextForActivity方法。</p>
<p><strong>ActivityThread#createBaseContextForActivity</strong></p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">private <span class="built_in">Context</span> createBaseContextForActivity(ActivityClientRecord r,</span><br><span class="line">            final Activity activity) &#123;</span><br><span class="line">        ContextImpl appContext = ContextImpl.createActivityContext(this, r.packageInfo, r.token)<span class="comment">;</span></span><br><span class="line">        appContext.setOuterContext(activity)<span class="comment">;</span></span><br><span class="line">        <span class="built_in">Context</span> <span class="keyword">baseContext </span>= appContext<span class="comment">;</span></span><br><span class="line">   .............</span><br><span class="line">   return <span class="keyword">baseContext；</span></span><br><span class="line"><span class="keyword">&#125;</span></span><br></pre></td></tr></table></figure>
<p>分析：该方法里面的确创建了一个ContextImpl对象，并且返回该对象。同时也调用了ContextImpl#setOuterConexet方法让ContextImpl持有外部Activity对象的引用，目的是在ContextImpl类中注册一些服务，设置主题等都需要外部Activity对象的引用。</p>
<p><strong>setp3 </strong><br>由于Activity没有重写构造方法，因此创建出来的Activity并没有初始化。为了对Activity初始化，以上代码调用了Activity#attach方法来进行初始化操作。</p>
<p><strong>Activity#attach</strong></p>
<figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">public <span class="keyword">class</span> Activity extends ContextThemeWrapper</span><br><span class="line">        implements LayoutInflater.Factory2,</span><br><span class="line">        Window.Callback, KeyEvent.Callback,</span><br><span class="line">        OnCreateContextMenuListener, ComponentCallbacks2,</span><br><span class="line">        Window.OnWindowDismissedCallback &#123;</span><br><span class="line"></span><br><span class="line">............................</span><br><span class="line"></span><br><span class="line">final void attach(Context context, ActivityThread aThread,</span><br><span class="line">            Instrumentation instr, IBinder token, int ident,</span><br><span class="line">            Application application, Intent intent, ActivityInfo info,</span><br><span class="line">            CharSequence title, Activity parent, String id,</span><br><span class="line">            NonConfigurationInstances lastNonConfigurationInstances,</span><br><span class="line">            Configuration config, IVoiceInteractor voiceInteractor) &#123;</span><br><span class="line">        <span class="comment">//调用父类方法对mBase变量赋值</span></span><br><span class="line">        attachBaseContext(context);</span><br><span class="line">        <span class="comment">//创建一个Activity的窗口</span></span><br><span class="line">        mWindow = PolicyManager.makeNewWindow(this);</span><br><span class="line">        <span class="comment">//给Window窗口设置回调事件</span></span><br><span class="line">        mWindow.setCallback(this);</span><br><span class="line">        mWindow.setOnWindowDismissedCallback(this);</span><br><span class="line">        mWindow.getLayoutInflater().setPrivateFactory(this);</span><br><span class="line">        <span class="comment">//设置键盘弹出状态</span></span><br><span class="line">        <span class="keyword">if</span> (info.softInputMode != WindowManager.LayoutParams.SOFT_INPUT_STATE_UNSPECIFIED) &#123;</span><br><span class="line">            mWindow.setSoftInputMode(info.softInputMode);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (info.uiOptions != <span class="number">0</span>) &#123;</span><br><span class="line">            mWindow.setUiOptions(info.uiOptions);</span><br><span class="line">        &#125;</span><br><span class="line">        mUiThread = Thread.currentThread();</span><br><span class="line"></span><br><span class="line">        mMainThread = aThread;</span><br><span class="line">        mInstrumentation = instr;</span><br><span class="line">        mToken = token;</span><br><span class="line">        mIdent = ident;</span><br><span class="line">        <span class="comment">//此处注意，将整个应用的Application对象赋值给Activity的mApplication成员变量。</span></span><br><span class="line">        <span class="comment">//目的是为了能在Activity中通过getApplication方法来直接获取Application对象</span></span><br><span class="line">        mApplication = application;</span><br><span class="line">       ......................</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//在Activity中返回当前应用的Application对象</span></span><br><span class="line"><span class="comment">/** Return the application that owns this activity. */</span></span><br><span class="line">    public final Application getApplication() &#123;</span><br><span class="line">        return mApplication;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>分析：attach方法一进来就调用了父类的attachBaseContext方法将ContextImpl对象注册到Activity里面去。由于Activity的父类是ContextThemeWrapper，进入该类查看attachBaseContext方法</p>
<p><strong>ContextThemeWrapper#attachBaseContext</strong></p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">ContextThemeWrapper</span> <span class="keyword">extends</span> <span class="title">ContextWrapper</span> </span>&#123;</span><br><span class="line">   ............</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span> <span class="keyword">protected</span> void attachBaseContext(<span class="type">Context</span> newBase) &#123;</span><br><span class="line">        <span class="keyword">super</span>.attachBaseContext(newBase);</span><br><span class="line">    &#125;</span><br><span class="line">    ...........</span><br></pre></td></tr></table></figure>
<p>该方法也很简单，还是调用父类的attachBaseContext方法注册ContextImpl，然而该类的父类就是ContextWrapper类。 </p>
<p><strong>ContextWrapper#attachBaseContext</strong></p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">ContextWrapper</span> <span class="keyword">extends</span> <span class="title">Context</span> </span>&#123;</span><br><span class="line">..............</span><br><span class="line"> <span class="keyword">protected</span> void attachBaseContext(<span class="type">Context</span> base) &#123;</span><br><span class="line">        <span class="keyword">if</span> (mBase != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="type">IllegalStateException</span>(<span class="string">"Base context already set"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        mBase = base;</span><br><span class="line">    &#125;</span><br><span class="line">..........</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在ContextWrapper类中调用attachBaseContext方法将ContextImpl对象（真正实现Context抽象类里面各种方法的类）赋值给mBase成员变量，而ContextWrapper只是一个装饰类，里面所有方法的实现都是调用mBase的方法。此时mBase方法被赋值成ContextImpl对象，这么一来Activity的祖父类就实现了里面的所有Context抽象方法，那么在Activity中可以调用Context里面的任何方法了。</p>
<h4 id="3-5-Service中的Context"><a href="#3-5-Service中的Context" class="headerlink" title="3.5 Service中的Context"></a>3.5 Service中的Context</h4><p>同样创建Service也是有ASM通过Binder机制通知ActivityThread类去创建一个Service服务了，最后会辗转到ActivityThread#handleCreateService方法中来创建一个Service服务。</p>
<p><strong>ActivityThread#handleCreateService</strong></p>
<figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">private void handleCreateService(CreateServiceData data) &#123;</span><br><span class="line"></span><br><span class="line">        LoadedApk packageInfo = getPackageInfoNoCheck(</span><br><span class="line">                data.info.applicationInfo, data.compatInfo);</span><br><span class="line">        Service service = null;</span><br><span class="line">        try &#123;</span><br><span class="line">            <span class="comment">//通过类加载器创建Service服务</span></span><br><span class="line">            java.lang.ClassLoader cl = packageInfo.getClassLoader();</span><br><span class="line">            service = (Service) cl.loadClass(data.info.name).newInstance();</span><br><span class="line">        &#125; </span><br><span class="line">    .............</span><br><span class="line">        try &#123;</span><br><span class="line">          ............</span><br><span class="line">          <span class="comment">//此处为Service创建一个ContextImpl对象</span></span><br><span class="line">            ContextImpl context = ContextImpl.createAppContext(this, packageInfo);</span><br><span class="line">            <span class="comment">//同样为ContextImpl类设置外部对象，目的还是让ContextImpl持有外部类的引用</span></span><br><span class="line">            <span class="comment">//在ContextImpl类中的许多方法需要使用到外部Context对象引用</span></span><br><span class="line">            context.setOuterContext(service);</span><br><span class="line">    ................</span><br><span class="line">            <span class="comment">//获得当前应用的Applicaton对象，该对象在整个应用中只有一份，是共享的。</span></span><br><span class="line">            Application app = packageInfo.makeApplication(false, mInstrumentation);</span><br><span class="line">            <span class="comment">//将ContextImpl对象和Application对象作为attach方法参数来初始化Service</span></span><br><span class="line">            service.attach(context, this, data.info.name, data.token, app,</span><br><span class="line">                    ActivityManagerNative.getDefault());</span><br><span class="line">            <span class="comment">//Service初始化完成之后系统自动调用onCreate生命周期方法</span></span><br><span class="line">            service.onCreate();</span><br><span class="line">     ................</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>分析：<br>跟以上Activity和Application创建类似，通过类加载器来创建Service对象。然后在创建一个ContextImpl对象，并且为ContextImpl类设置外部Service对象Context的引用，目的之在ContextImpl类中的许多方法都需要使用到外部Context引用。</p>
<p>其次和Activity一样调用packageInfo.makeApplication方法去获得当前应用的Application对象，然后将Application对象和ContextImpl对象作为Service#attach方法去初始化Service，当Service初始化完成之后，系统调用Service的生命周期方法onCreate方法，该方法是创建Service过程中最早暴露给开发者的，所有开发者在实现自己的Service时可以重写onCreate方法来进行一些初始化工作。</p>
<p>现在我们来分析下Service#attach方法</p>
<p><strong>Service#attach</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Service</span> <span class="keyword">extends</span> <span class="title">ContextWrapper</span> <span class="keyword">implements</span> <span class="title">ComponentCallbacks2</span> </span>&#123;</span><br><span class="line">    <span class="comment">//默认构造方法调用父类构造方法并且参数为null，意味着构造方法里并没有对Service初始化</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Service</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(<span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//在Service中返回整个应用的Application对象</span></span><br><span class="line">    <span class="comment">/** Return the application that owns this service. */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> Application <span class="title">getApplication</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> mApplication;</span><br><span class="line">    &#125;</span><br><span class="line">    ..............</span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@hide</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">attach</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">            Context context,</span></span></span><br><span class="line"><span class="function"><span class="params">            ActivityThread thread, String className, IBinder token,</span></span></span><br><span class="line"><span class="function"><span class="params">            Application application, Object activityManager)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//调用父类方法去注册ContextImpl对象</span></span><br><span class="line">        attachBaseContext(context);</span><br><span class="line">        mThread = thread;           <span class="comment">// <span class="doctag">NOTE:</span>  unused - remove?</span></span><br><span class="line">        mClassName = className;</span><br><span class="line">        mToken = token;</span><br><span class="line">        <span class="comment">//将整个应用的Applicaton对象赋值给Service类的成员变量mApplication</span></span><br><span class="line">        mApplication = application;</span><br><span class="line">        mActivityManager = (IActivityManager)activityManager;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>分析：<br>Service的父类是ContextWrapper，在attach方法中调用了父类中attachBaseContext方法去注册CotextImpl对象，这一操作和创建Application一样，具体参考前面分析。</p>
<h4 id="3-6总结"><a href="#3-6总结" class="headerlink" title="3.6总结"></a>3.6总结</h4><p>至此，一个Android应用可能创建Context的地方基本分析结束。所有有关创建Context对象的地方都是在ActivityThread类中，该类就是整个应用的入口，也是整个应用的主线程。每个应用首先会创建一个Application对象，且一个应用只有唯一一个Application对象，之后再根据需求创建Activity或者Service。且在创建Activity或者Service的时候都会持有一份当前应用的Application对象，通过getApplication方法即可获得。</p>
<p>不管在创建Application，Activity还是Service的时候都会去创建一个ContextImpl对象（真正实现抽象类Context功能的类就是ContextImpl），然后将该对象注册到对应的Application，Activity，Service中，之后在Application，Activity，Service类中就可以使用Context的所有功能了。所以Application，Activity，Service的祖先都是抽象类Context，相当于Context给了他们身体，让他们有了一个躯壳有思想，但真正让他们思想得到执行的类还是ContextImpl类。因此我们可以这么来理解：抽象类Context给了Application，Activity，Service思想，而ContextImpl类给了他们去执行思想的功能。</p>
<p>有以上分析我们知道，每创建一个Application，Activity还是Service都会创建一个ContextImpl类（真正实现Context类功能）。且一个应用只会创建一个Application对象。因此：<strong>一个App中Context的个数=1个Application+Activity的个数+Service的个数。</strong></p>
<h4 id="Context总结"><a href="#Context总结" class="headerlink" title="Context总结"></a>Context总结</h4><p>1、Context是什么？Context是”运行上下文环境“，从代码角度看Application，Service，Activity都是Context。</p>
<p>2、所有Context都是在应用的主线程ActivityThread中创建的，由于Application，Service，Activity的祖先都是Context抽象类，所以在创建它们的同时也会为每一个类创建一个ContextImpl类，ContextImpl是Context的之类，真正实现Context功能方法的类。因此Application，Service，Activity都关联着一个ContextImpl对象。</p>
<p>3、尽量少用Context对象去获取静态变量，静态方法，以及单例对象。以免导致内存泄漏。</p>
<p>4、在创建与UI相关的地方，比如创建一个Dialog，或者在代码中创建一个TextView，都用Activity的Context去创建。然而在引用静态资源，创建静态方法，单例模式等情况下，使用生命周期更长的Application的Context才不会导致内存泄漏。</p>

      
    </div>

    

    
    
    

    

    
       
    
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Context/" rel="tag"># Context</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/12/11/Android-屏幕适配方案/" rel="next" title="Android 屏幕适配方案">
                <i class="fa fa-chevron-left"></i> Android 屏幕适配方案
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/12/14/减少该死的if-else-嵌套/" rel="prev" title="减少该死的if else 嵌套">
                减少该死的if else 嵌套 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/avatarx.jpg" alt="Keem Wang">
            
              <p class="site-author-name" itemprop="name">Keem Wang</p>
              <p class="site-description motion-element" itemprop="description">Stay hungry Stay foolish</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">70</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">14</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">42</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          

          

          
          

          
            
          
          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-4"><a class="nav-link" href="#引言"><span class="nav-number">1.</span> <span class="nav-text">引言</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-Context是什么"><span class="nav-number">2.</span> <span class="nav-text">1.Context是什么</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-Android系统中Context的继承关系"><span class="nav-number">3.</span> <span class="nav-text">2.Android系统中Context的继承关系</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-不同Context源码分析"><span class="nav-number">4.</span> <span class="nav-text">3.不同Context源码分析</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1ContextImpl—真正实现Context功能的类"><span class="nav-number">5.</span> <span class="nav-text">3.1ContextImpl—真正实现Context功能的类</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2ContextWrapper"><span class="nav-number">6.</span> <span class="nav-text">3.2ContextWrapper</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3Application中的Context"><span class="nav-number">7.</span> <span class="nav-text">3.3Application中的Context</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-4Activity中的Context"><span class="nav-number">8.</span> <span class="nav-text">3.4Activity中的Context</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-5-Service中的Context"><span class="nav-number">9.</span> <span class="nav-text">3.5 Service中的Context</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-6总结"><span class="nav-number">10.</span> <span class="nav-text">3.6总结</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Context总结"><span class="nav-number">11.</span> <span class="nav-text">Context总结</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Keem Wang</span>

  

  
</div>


  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v3.8.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v6.5.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    
	
    

    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.5.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.5.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=6.5.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=6.5.0"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=6.5.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=6.5.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.5.0"></script>



  



  










  





  

  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  

  

  
  

  

  

  

  

  

  

</body>
</html>
