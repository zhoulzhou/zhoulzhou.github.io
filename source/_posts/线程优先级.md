---
title: 线程优先级
date: 2018-12-06 09:14:16
tags:
- 优先级
categories:
- 多线程
---
#### The Importance of Thread Priority
理论上来说，我们的程序可以创建出非常多的子线程一起并发执行的，可是基于CPU时间片轮转调度的机制，不可能所有的线程都可以同时被调度执行，CPU需要根据线程的优先级赋予不同的时间片。

{% asset_img xian1.png %}

Android系统会根据当前运行的可见的程序和不可见的后台程序对线程进行归类，**划分为forground的那部分线程会大致占用掉CPU的90%左右的时间片，background的那部分线程就总共只能分享到5%-10%左右的时间片。**之所以设计成这样是因为forground的程序本身的优先级就更高，理应得到更多的执行时间。

{% asset_img xian2.png %}

**默认情况下，新创建的线程的优先级默认和创建它的母线程保持一致。**如果主UI线程创建出了几十个工作线程，这些工作线程的优先级就默认和主线程保持一致了，为了不让新创建的工作线程和主线程抢占CPU资源，需要把这些线程的优先级进行降低处理，这样才能给帮组CPU识别主次，提高主线程所能得到的系统资源。

{% asset_img xian3.png %}

在Android系统里面，我们可以通过android.os.Process.setThreadPriority(int)设置线程的优先级，参数范围从-20到24，数值越小优先级越高。Android系统还为我们提供了以下的一些预设值，我们可以通过给不同的工作线程设置不同数值的优先级来达到更细粒度的控制。

{% asset_img xian4.png %}

**大多数情况下，新创建的线程优先级会被设置为默认的0，主线程设置为0的时候，新创建的线程还可以利用THREAD_PRIORITY_LESS_FAVORABLE或者THREAD_PRIORITY_MORE_FAVORABLE来控制线程的优先级。**

{% asset_img xian5.png %}

Android系统里面的AsyncTask与IntentService已经默认帮助我们设置线程的优先级，但是对于那些非官方提供的多线程工具类，我们需要特别留意根据需要自己手动来设置线程的优先级。

{% asset_img xian6.png %}

{% asset_img xian7.png %}
